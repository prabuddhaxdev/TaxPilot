generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  email     String  @unique
  name      String?
  image     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  accounts   Account[]
  sessions   Session[]
  password   Password?

  taxProfile         TaxProfile?
  salaryStructure    SalaryStructure?
  calculations       TaxCalculationHistory[]
}

model Account {
  id                String   @id @default(uuid())
  provider          String   // "google", "github", "email"
  providerAccountId String   // OAuth sub ID / email
  userId            String

  user     User @relation(fields: [userId], references: [id], onDelete: Cascade)

  accessToken        String?
  refreshToken       String?
  expiresAt          Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerAccountId])
}

model Password {
  id        String   @id @default(uuid())
  userId    String   @unique
  hash      String   // bcrypt hash for email-password login
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Session {
  id        String   @id @default(uuid())
  sessionToken String @unique
  userId    String
  expires   DateTime

  user      User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TaxProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  ageGroup           String
  regimePreference   String
  residentialStatus  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SalaryStructure {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  basicSalary      Float
  hra              Float
  allowances       Float
  specialAllowance Float
  lta              Float
  professionalTax  Float
  epfEmployee      Float
  epfEmployer      Float
  otherDeductions  Float   @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TaxCalculationHistory {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  financialYear   String
  regimeUsed      String
  inputs          Json
  result          Json
  explanation     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
